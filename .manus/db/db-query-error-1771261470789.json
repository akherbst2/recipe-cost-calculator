{
  "query": "\n-- Get total sessions and unique users\nSELECT \n  COUNT(DISTINCT sessionId) as total_sessions,\n  COUNT(DISTINCT userId) as unique_users,\n  COUNT(DISTINCT CASE WHEN userId IS NOT NULL THEN userId END) as authenticated_users,\n  COUNT(DISTINCT CASE WHEN userId IS NULL THEN sessionId END) as anonymous_sessions\nFROM events\nWHERE referrer NOT LIKE '%manus.im%'\n  AND (userId IS NULL OR userId != (SELECT value FROM (SELECT value FROM JSON_TABLE(\n    CONCAT('[', REPLACE(REPLACE((SELECT GROUP_CONCAT(DISTINCT CONCAT('\"', value, '\"')) FROM JSON_TABLE(\n      JSON_OBJECT('VITE_OWNER_OPEN_ID', ''), '$.*' COLUMNS (value VARCHAR(255) PATH '$')\n    ) jt), '\"\"', ''), ',', '\",\"'), ']'),\n    '$[*]' COLUMNS (value VARCHAR(255) PATH '$')\n  ) AS owner_check LIMIT 1));\n\n-- Get event type distribution\nSELECT \n  eventType,\n  COUNT(*) as event_count,\n  COUNT(DISTINCT sessionId) as sessions_with_event\nFROM events\nWHERE referrer NOT LIKE '%manus.im%'\nGROUP BY eventType\nORDER BY event_count DESC;\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2vGuTCYzpyNQ1XN.root --database cUKXq5uw3eiWGpv5roCqyH --execute \n-- Get total sessions and unique users\nSELECT \n  COUNT(DISTINCT sessionId) as total_sessions,\n  COUNT(DISTINCT userId) as unique_users,\n  COUNT(DISTINCT CASE WHEN userId IS NOT NULL THEN userId END) as authenticated_users,\n  COUNT(DISTINCT CASE WHEN userId IS NULL THEN sessionId END) as anonymous_sessions\nFROM events\nWHERE referrer NOT LIKE '%manus.im%'\n  AND (userId IS NULL OR userId != (SELECT value FROM (SELECT value FROM JSON_TABLE(\n    CONCAT('[', REPLACE(REPLACE((SELECT GROUP_CONCAT(DISTINCT CONCAT('\"', value, '\"')) FROM JSON_TABLE(\n      JSON_OBJECT('VITE_OWNER_OPEN_ID', ''), '$.*' COLUMNS (value VARCHAR(255) PATH '$')\n    ) jt), '\"\"', ''), ',', '\",\"'), ']'),\n    '$[*]' COLUMNS (value VARCHAR(255) PATH '$')\n  ) AS owner_check LIMIT 1));\n\n-- Get event type distribution\nSELECT \n  eventType,\n  COUNT(*) as event_count,\n  COUNT(DISTINCT sessionId) as sessions_with_event\nFROM events\nWHERE referrer NOT LIKE '%manus.im%'\nGROUP BY eventType\nORDER BY event_count DESC;\n",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 3: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 8 column 85 near \"(",
    "    CONCAT('[', REPLACE(REPLACE((SELECT GROUP_CONCAT(DISTINCT CONCAT('\"', value, '\"')) FROM JSON_TABLE(",
    "      JSON_OBJECT('VITE_OWNER_OPEN_ID', ''), '$.*' COLUMNS (value VARCHAR(255) PATH '$')",
    "    ) jt), '\"\"', ''), ',', '\",\"'), ']'),",
    "    '$[*]' COLUMNS (value VARCHAR(255) PATH '$')",
    "  ) AS owner_check LIMIT 1))\""
  ]
}